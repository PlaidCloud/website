<!doctype html><html lang=en class=no-js>
<head>
<meta name=ROBOTS content="INDEX, FOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-36037335-10"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-36037335-10')</script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.92.1">
<link rel=canonical type=text/html href=https://plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>
<link rel="shortcut icon" type=image/png href=/images/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=manifest href=/manifest.webmanifest>
<link rel=apple-touch-icon href=/images/PlaidCloud-192x192.png>
<title>Migrating from dockershim | PlaidCloud</title><meta property="og:title" content="Migrating from dockershim">
<meta property="og:description" content="Unified Financial Analytics">
<meta property="og:type" content="website">
<meta property="og:url" content="https://plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/"><meta property="og:site_name" content="PlaidCloud">
<meta itemprop=name content="Migrating from dockershim">
<meta itemprop=description content="Unified Financial Analytics"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Migrating from dockershim">
<meta name=twitter:description content="Unified Financial Analytics">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.01c7a67b0bd0142cbb01c908f6fba66be344bb33b67486e8e79e22f103b192f4.css as=style>
<link href=/scss/main.min.01c7a67b0bd0142cbb01c908f6fba66be344bb33b67486e8e79e22f103b192f4.css rel=stylesheet integrity>
<script src=/js/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://plaidcloud.com","logo":"https://plaidcloud.com/images/favicon.ico","potentialAction":{"@type":"SearchAction","target":"https://plaidcloud.com/search/?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<meta name=theme-color content="#326ce5">
<link rel=stylesheet href=/css/feature-states.css>
<meta name=description content="This section presents information you need to know when migrating from dockershim to other container runtimes.
Since the announcement of dockershim deprecation in PlaidCloud 1.20, there were questions on how this will affect various workloads and PlaidCloud installations. You can find this blog post useful to understand the problem better: Dockershim Deprecation FAQ
It is recommended to migrate from dockershim to alternative container runtimes. Check out container runtimes section to know your options.">
<meta property="og:description" content="This section presents information you need to know when migrating from dockershim to other container runtimes.
Since the announcement of dockershim deprecation in PlaidCloud 1.20, there were questions on how this will affect various workloads and PlaidCloud installations. You can find this blog post useful to understand the problem better: Dockershim Deprecation FAQ
It is recommended to migrate from dockershim to alternative container runtimes. Check out container runtimes section to know your options.">
<meta name=twitter:description content="This section presents information you need to know when migrating from dockershim to other container runtimes.
Since the announcement of dockershim deprecation in PlaidCloud 1.20, there were questions on how this will affect various workloads and PlaidCloud installations. You can find this blog post useful to understand the problem better: Dockershim Deprecation FAQ
It is recommended to migrate from dockershim to alternative container runtimes. Check out container runtimes section to know your options.">
<meta property="og:url" content="https://plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/">
<meta property="og:title" content="Migrating from dockershim">
<meta name=twitter:title content="Migrating from dockershim">
<meta name=twitter:image content="https://plaidcloud.com/images/favicon.ico">
<meta name=twitter:image:alt content="PlaidCloud">
<meta property="og:image" content="/images/PlaidCloud-horizontal-color.png">
<meta property="og:type" content="article">
<script src=/js/script.js></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary>
<a class=navbar-brand href=/></a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-2 mb-lg-0">
<a class="nav-link active" href=/docs/>Documentation</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/api/>APIs</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/plaidxl/>PlaidXL</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/plaidlink/>PlaidLink</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/tips/>Tips & Tricks</span></a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
Versions
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/releases>Release Information</a>
<a class=dropdown-item href=https://docs.plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>v5.10</a>
<a class=dropdown-item href=https://v5-9.docs.plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>v5.9</a>
<a class=dropdown-item href=https://v5-8.docs.plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>v5.8</a>
<a class=dropdown-item href=https://v5-7.docs.plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>v5.7</a>
<a class=dropdown-item href=https://v5-6.docs.plaidcloud.com/docs/tasks/administer-cluster/migrating-from-dockershim/>v5.6</a>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
English
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/de/>Deutsch</a>
<a class=dropdown-item href=/es/>Espa√±ol</a>
</div>
</li>
</ul>
</div>
<button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div>
<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.
</p><p>
<a href=/docs/tasks/administer-cluster/migrating-from-dockershim/>Return to the regular view of this page</a>.
</p>
</div>
<h1 class=title>Migrating from dockershim</h1>
<ul>
<li>1: <a href=#pg-d79db9ed1698f75ec5f2228987290e49>Find Out What Container Runtime is Used on a Node</a></li>
<li>2: <a href=#pg-58702e4818c09c9b3d574349c1a71cb3>Check whether Dockershim deprecation affects you</a></li>
<li>3: <a href=#pg-eb3e279a6c5e1224e744080a52ee3f28>Migrating telemetry and security agents from dockershim</a></li>
</ul>
<div class=content>
<p>This section presents information you need to know when migrating from
dockershim to other container runtimes.</p>
<p>Since the announcement of <a href=/blog/2020/12/08/PlaidCloud-1-20-release-announcement/#dockershim-deprecation>dockershim deprecation</a>
in PlaidCloud 1.20, there were questions on how this will affect various workloads and PlaidCloud
installations. You can find this blog post useful to understand the problem better: <a href=/blog/2020/12/02/dockershim-faq/>Dockershim Deprecation FAQ</a></p>
<p>It is recommended to migrate from dockershim to alternative container runtimes.
Check out <a href=/docs/setup/production-environment/container-runtimes/>container runtimes</a>
section to know your options. Make sure to
<a href=https://github.com/PlaidCloud/PlaidCloud/issues>report issues</a> you encountered
with the migration. So the issue can be fixed in a timely manner and your cluster would be
ready for dockershim removal.</p>
</div>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-d79db9ed1698f75ec5f2228987290e49>1 - Find Out What Container Runtime is Used on a Node</h1>
<p>This page outlines steps to find out what <a href=/docs/setup/production-environment/container-runtimes/>container runtime</a>
the nodes in your cluster use.</p>
<p>Depending on the way you run your cluster, the container runtime for the nodes may
have been pre-configured or you need to configure it. If you're using a managed
PlaidCloud service, there might be vendor-specific ways to check what container runtime is
configured for the nodes. The method described on this page should work whenever
the execution of <code>kubectl</code> is allowed.</p>
<h2 id=before-you-begin>Before you begin</h2>
<p>Install and configure <code>kubectl</code>. See <a href=/docs/tasks/tools/#kubectl>Install Tools</a> section for details.</p>
<h2 id=find-out-the-container-runtime-used-on-a-node>Find out the container runtime used on a Node</h2>
<p>Use <code>kubectl</code> to fetch and show node information:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get nodes -o wide
</code></pre></div><p>The output is similar to the following. The column <code>CONTAINER-RUNTIME</code> outputs
the runtime and its version.</p>
<pre tabindex=0><code class=language-none data-lang=none># For dockershim
NAME         STATUS   VERSION    CONTAINER-RUNTIME
node-1       Ready    v1.16.15   docker://19.3.1
node-2       Ready    v1.16.15   docker://19.3.1
node-3       Ready    v1.16.15   docker://19.3.1
</code></pre><pre tabindex=0><code class=language-none data-lang=none># For containerd
NAME         STATUS   VERSION   CONTAINER-RUNTIME
node-1       Ready    v1.19.6   containerd://1.4.1
node-2       Ready    v1.19.6   containerd://1.4.1
node-3       Ready    v1.19.6   containerd://1.4.1
</code></pre><p>Find out more information about container runtimes
on <a href=/docs/setup/production-environment/container-runtimes/>Container Runtimes</a> page.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-58702e4818c09c9b3d574349c1a71cb3>2 - Check whether Dockershim deprecation affects you</h1>
<p>The <code>dockershim</code> component of PlaidCloud allows to use Docker as a PlaidCloud's
<a class=glossary-tooltip title="The container runtime is the software that is responsible for running containers." data-toggle=tooltip data-placement=top href=/docs/setup/production-environment/container-runtimes target=_blank aria-label="container runtime">container runtime</a>.
PlaidCloud' built-in <code>dockershim</code> component was deprecated in release v1.20.</p>
<p>This page explains how your cluster could be using Docker as a container runtime,
provides details on the role that <code>dockershim</code> plays when in use, and shows steps
you can take to check whether any workloads could be affected by <code>dockershim</code> deprecation.</p>
<h2 id=find-docker-dependencies>Finding if your app has a dependencies on Docker</h2>
<p>If you are using Docker for building your application containers, you can still
run these containers on any container runtime. This use of Docker does not count
as a dependency on Docker as a container runtime.</p>
<p>When alternative container runtime is used, executing Docker commands may either
not work or yield unexpected output. This is how you can find whether you have a
dependency on Docker:</p>
<ol>
<li>Make sure no privileged Pods execute Docker commands (like <code>docker ps</code>),
restart the Docker service (commands such as <code>systemctl restart docker.service</code>),
or modify Docker-specific files such as <code>/etc/docker/daemon.json</code>.</li>
<li>Check for any private registries or image mirror settings in the Docker
configuration file (like <code>/etc/docker/daemon.json</code>). Those typically need to
be reconfigured for another container runtime.</li>
<li>Check that scripts and apps running on nodes outside of your PlaidCloud
infrastructure do not execute Docker commands. It might be:
<ul>
<li>SSH to nodes to troubleshoot;</li>
<li>Node startup scripts;</li>
<li>Monitoring and security agents installed on nodes directly.</li>
</ul>
</li>
<li>Third-party tools that perform above mentioned privileged operations. See
<a href=/docs/tasks/administer-cluster/migrating-from-dockershim/migrating-telemetry-and-security-agents>Migrating telemetry and security agents from dockershim</a>
for more information.</li>
<li>Make sure there is no indirect dependencies on dockershim behavior.
This is an edge case and unlikely to affect your application. Some tooling may be configured
to react to Docker-specific behaviors, for example, raise alert on specific metrics or search for
a specific log message as part of troubleshooting instructions.
If you have such tooling configured, test the behavior on test
cluster before migration.</li>
</ol>
<h2 id=role-of-dockershim>Dependency on Docker explained</h2>
<p>A <a href=/docs/concepts/containers/#container-runtimes>container runtime</a> is software that can
execute the containers that make up a PlaidCloud pod. PlaidCloud is responsible for orchestration
and scheduling of Pods; on each node, the <a class=glossary-tooltip title="An agent that runs on each node in the cluster. It makes sure that containers are running in a pod." data-toggle=tooltip data-placement=top href=/docs/reference/generated/kubelet target=_blank aria-label=kubelet>kubelet</a>
uses the container runtime interface as an abstraction so that you can use any compatible
container runtime.</p>
<p>In its earliest releases, PlaidCloud offered compatibility with one container runtime: Docker.
Later in the PlaidCloud project's history, cluster operators wanted to adopt additional container runtimes.
The CRI was designed to allow this kind of flexibility - and the kubelet began supporting CRI. However,
because Docker existed before the CRI specification was invented, the PlaidCloud project created an
adapter component, <code>dockershim</code>. The dockershim adapter allows the kubelet to interact with Docker as
if Docker were a CRI compatible runtime.</p>
<p>You can read about it in <a href=/blog/2018/05/24/PlaidCloud-containerd-integration-goes-ga/>PlaidCloud Containerd integration goes GA</a> blog post.</p>
<p><img src=/images/blog/2018-05-24-PlaidCloud-containerd-integration-goes-ga/cri-containerd.png alt="Dockershim vs. CRI with Containerd"></p>
<p>Switching to Containerd as a container runtime eliminates the middleman. All the
same containers can be run by container runtimes like Containerd as before. But
now, since containers schedule directly with the container runtime, they are not visible to Docker.
So any Docker tooling or fancy UI you might have used
before to check on these containers is no longer available.</p>
<p>You cannot get container information using <code>docker ps</code> or <code>docker inspect</code>
commands. As you cannot list containers, you cannot get logs, stop containers,
or execute something inside container using <code>docker exec</code>.</p>
<div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> If you're running workloads via PlaidCloud, the best way to stop a container is through
the PlaidCloud API rather than directly through the container runtime (this advice applies
for all container runtimes, not only Docker).
</div>
<p>You can still pull images or build them using <code>docker build</code> command. But images
built or pulled by Docker would not be visible to container runtime and
PlaidCloud. They needed to be pushed to some registry to allow them to be used
by PlaidCloud.</p>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-eb3e279a6c5e1224e744080a52ee3f28>3 - Migrating telemetry and security agents from dockershim</h1>
<p>PlaidCloud' support for direct integration with Docker Engine is deprecated, and will be removed. Most apps do not have a direct dependency on runtime hosting containers. However, there are still a lot of telemetry and monitoring agents that has a dependency on docker to collect containers metadata, logs and metrics. This document aggregates information on how to detect these dependencies and links on how to migrate these agents to use generic tools or alternative runtimes.</p>
<h2 id=telemetry-and-security-agents>Telemetry and security agents</h2>
<p>Within a PlaidCloud cluster there are a few different ways to run telemetry or security agents.
Some agents have a direct dependency on Docker Engine when they as DaemonSets or
directly on nodes.</p>
<h3 id=why-do-some-telemetry-agents-communicate-with-docker-engine>Why do some telemetry agents communicate with Docker Engine?</h3>
<p>Historically, PlaidCloud was written to work specifically with Docker Engine.
PlaidCloud took care of networking and scheduling, relying on Docker Engine for launching
and running containers (within Pods) on a node. Some information that is relevant to telemetry,
such as a pod name, is only available from PlaidCloud components. Other data, such as container
metrics, is not the responsibility of the container runtime. Early yelemetry agents needed to query the
container runtime <strong>and</strong> PlaidCloud to report an accurate picture. Over time, PlaidCloud gained
the ability to support multiple runtimes, and now supports any runtime that is compatible with
the container runtime interface.</p>
<p>Some telemetry agents rely specifically on Docker Engine tooling. For example, an agent
might run a command such as
<a href=https://docs.docker.com/engine/reference/commandline/ps/><code>docker ps</code></a>
or <a href=https://docs.docker.com/engine/reference/commandline/top/><code>docker top</code></a> to list
containers and processes or <a href=https://docs.docker.com/engine/reference/commandline/logs/><code>docker logs</code></a>
to receive streamed logs. If nodes in your existing cluster use
Docker Engine, and you switch to a different container runtime,
these commands will not work any longer.</p>
<h3 id=identify-docker-dependency>Identify DaemonSets that depend on Docker Engine</h3>
<p>If a pod wants to make calls to the <code>dockerd</code> running on the node, the pod must either:</p>
<ul>
<li>mount the filesystem containing the Docker daemon's privileged socket, as a
<a class=glossary-tooltip title="A directory containing data, accessible to the containers in a pod." data-toggle=tooltip data-placement=top href=/docs/concepts/storage/volumes/ target=_blank aria-label=volume>volume</a>; or</li>
<li>mount the specific path of the Docker daemon's privileged socket directly, also as a volume.</li>
</ul>
<p>For example: on COS images, Docker exposes its Unix domain socket at
<code>/var/run/docker.sock</code> This means that the pod spec will include a
<code>hostPath</code> volume mount of <code>/var/run/docker.sock</code>.</p>
<p>Here's a sample shell script to find Pods that have a mount directly mapping the
Docker socket. This script outputs the namespace and name of the pod. You can
remove the <code>grep '/var/run/docker.sock'</code> to review other mounts.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>kubectl get pods --all-namespaces <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>-o<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>&#39;{range .items[*]}{&#34;\n&#34;}{.metadata.namespace}{&#34;:\t&#34;}{.metadata.name}{&#34;:\t&#34;}{range .spec.volumes[*]}{.hostPath.path}{&#34;, &#34;}{end}{end}&#39;</span> <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>| sort <span style=color:#b62;font-weight:700>\
</span><span style=color:#b62;font-weight:700></span>| grep <span style=color:#b44>&#39;/var/run/docker.sock&#39;</span>
</code></pre></div><div class="alert alert-info note callout" role=alert>
<strong>Note:</strong> There are alternative ways for a pod to access Docker on the host. For instance, the parent
directory <code>/var/run</code> may be mounted instead of the full path (like in <a href=https://gist.github.com/itaysk/7bc3e56d69c4d72a549286d98fd557dd>this
example</a>).
The script above only detects the most common uses.
</div>
<h3 id=detecting-docker-dependency-from-node-agents>Detecting Docker dependency from node agents</h3>
<p>In case your cluster nodes are customized and install additional security and
telemetry agents on the node, make sure to check with the vendor of the agent whether it has dependency on Docker.</p>
<h3 id=telemetry-and-security-agent-vendors>Telemetry and security agent vendors</h3>
<p>We keep the work in progress version of migration instructions for various telemetry and security agent vendors
in <a href=https://docs.google.com/document/d/1ZFi4uKit63ga5sxEiZblfb-c23lFhvy6RXVPikS8wf0/edit#>Google doc</a>.
Please contact the vendor to get up to date instructions for migrating from dockershim.</p>
</div>
</main>
</div>
</div>
<footer class=d-print-none>
<div class=footer__links>
<nav>
<a class=text-white href=/docs/home/>Home</a>
</nav>
</div>
<div class=container-fluid>
<div class=row>
<div class="col-6 col-sm-2 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank href=https://discuss.PlaidCloud.io>
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank href=https://twitter.com/plaidcloud>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube>
<a class=text-white target=_blank href=https://youtube.com/plaidcloud>
<i class="fab fa-youtube"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank href=https://github.com/plaidcloud>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank href=https://slack.plaidcloud.com>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/plaidcloud>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-8 text-center order-sm-2">
<small class=text-white>&copy; 2022 Tartan Solutions, Inc | PlaidCloud is our SaaS platform for Financial Analytics</small>
<br>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper-1.14.3.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap-4.3.1.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/main.min.8b80c14bafc28ac0131eea78e5bd67d87c35913ab8c46a0686b3586d37a608c6.js integrity="sha256-i4DBS6/CisATHup45b1n2Hw1kTq4xGoGhrNYbTemCMY=" crossorigin=anonymous></script>
</body>
</html>